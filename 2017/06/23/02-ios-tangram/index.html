<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <meta name="description" content="null">
  <meta name="keyword" content="undefined">
  <title>
    
      初识阿里Tangram | Even&#39;s home
    
  </title>
  <link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="//cdn.bootcss.com/highlight.js/9.12.0/styles/[object Object].min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/gitment.css">
  <script src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
  <script src="//cdn.bootcss.com/geopattern/1.2.3/js/geopattern.min.js"></script>
  <script src="/js/qrious.js"></script>
  <script src="/js/gitment.js"></script>
</head>
  <body>
    <header class="header fixed-header">
  <div class="header-container">
    <a class="home-link" href="/">
      <div class="logo"></div>
      <span>Even's home</span>
    </a>
    <ul class="right-list">
      
    </ul>
    <div class="menu">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </div>
    <div class="menu-mask">
      <ul class="menu-list">
        
      </ul>
    </div>
  </div>
</header>

    <div id="article-banner">
  <h2>初识阿里Tangram</h2>
  <p class="post-date">2017-06-23</p>
  <div class="arrow-down">
    <a href="javascript:;"></a>
  </div>
</div>
<main class="app-body">
  <article class="post-article">
    <section class="markdown-content"><!-- EventBus:事件总线,提供组件/布局/tangramView之间的通信渠道
Helper: 提供数据Model到ViewModel, ViewModel到View之间的转换
Core: 提供复用回收机制
Layout: 布局/组件摆放 -->
<p>Tangram, 阿里开源动态搭建页面的组件,支持瀑布流/浮动/吸顶/轮播等多种布局方式,通过后台json配置,实现页面的动态更新.</p>
<p>tangram主要由页面/卡片/组件三部分组成.<br><img src="https://ooo.0o0.ooo/2017/06/23/594cd534b1db1.png" alt="tangram三大块"></p>
<h1 id="组成部分"><a href="#组成部分" class="headerlink" title="组成部分"></a>组成部分</h1><h2 id="页面"><a href="#页面" class="headerlink" title="页面"></a>页面</h2><p>通过<a href="https://github.com/alibaba/LazyScrollView" target="_blank" rel="external">LazyScrollView</a>实现,是页面容器,所有的卡片和组件都添加在页面中</p>
<h2 id="卡片"><a href="#卡片" class="headerlink" title="卡片"></a>卡片</h2><p>卡片: 负责布局逻辑,对组件进行组合布局,只声明布局方式,不提供布局细节,由header/footer/body/style[样式:边距/间距/宽高比]组成.</p>
<blockquote>
<p>流式布局/瀑布流布局/吸顶式布局/悬浮布局/轮播布局<br>仅轮播卡片与通用流式卡片支持header/footer</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&quot;type&quot;:1, </div><div class="line">// &quot;type&quot;:2 </div><div class="line">&quot;style&quot;:&#123; --&gt; 描述样式</div><div class="line"></div><div class="line">&#125;,</div><div class="line"></div><div class="line">&quot;header&quot;:&#123;</div><div class="line">&#125;,</div><div class="line"></div><div class="line">&quot;footer&quot;:&#123;</div><div class="line">&#125;,</div><div class="line"></div><div class="line">&quot;items&quot;:[  ---&gt; 组件列表描述</div><div class="line">]</div></pre></td></tr></table></figure>
<h2 id="组件"><a href="#组件" class="headerlink" title="组件"></a>组件</h2><blockquote>
<p>包括类型/数据/样式<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">	&quot;type&quot; : &quot;2&quot; --&gt;TangramSingleImageElement,图片类型</div><div class="line">	// type=1为TangramSimpleTextElement,文字类型</div><div class="line"></div><div class="line">	&quot;style&quot;:&#123;  --&gt;描述组件样式</div><div class="line">		&quot;margin&quot;:[</div><div class="line">			10,10,10,10</div><div class="line">		],</div><div class="line">		&quot;height&quot;: 100,</div><div class="line">		&quot;width&quot;: 100,</div><div class="line">		&quot;bgColor&quot;: &quot;#ffffff&quot;</div><div class="line">	&#125;,</div><div class="line">	&quot;imgurl&quot;: &quot;../img.png&quot;,</div><div class="line">	&quot;title&quot;: &quot;&quot;,</div><div class="line">	&quot;action&quot;: &quot;&quot;,</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</blockquote>
<h1 id="各布局详细说明"><a href="#各布局详细说明" class="headerlink" title="各布局详细说明"></a>各布局详细说明</h1><p><a href="http://tangram.pingguohe.net/docs/layout-support/flow-layout" target="_blank" rel="external">流式布局:TangramFlowLayout</a></p>
<p><a href="http://tangram.pingguohe.net/docs/layout-support/waterflow-layout" target="_blank" rel="external">瀑布流式布局:TangramWaterFlowLayout</a></p>
<p><a href="http://tangram.pingguohe.net/docs/layout-support/oneplusn-layout" target="_blank" rel="external">一拖N布局:TangramSingleAndDoubleLayout</a></p>
<p><a href="http://tangram.pingguohe.net/docs/layout-support/float-layout" target="_blank" rel="external">浮动布局:TangramDragableLayout</a></p>
<p><a href="hhttp://tangram.pingguohe.net/docs/layout-support/sticky-layout" target="_blank" rel="external">吸顶/吸底布局:TangramStickyLayout</a></p>
<p><a href="http://tangram.pingguohe.net/docs/layout-support/pagescroll-layout" target="_blank" rel="external">轮播布局:TangramPageScrollLayout</a></p>
<p>以流式布局为例:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">	&quot;margin&quot;: [9,9,9,9] --&gt; 卡片外边距:上右下左</div><div class="line">	&quot;padding&quot;: [9,9,9,9] --&gt; 卡片内间距:上右下左</div><div class="line">	&quot;aspectRadio&quot;: &quot;9&quot;  --&gt; 每一行的宽高比</div><div class="line">	&quot;vGap&quot;: &quot;9&quot;   		--&gt; 组件间的坚直间距</div><div class="line">	&quot;hGap&quot;: &quot;9&quot;			--&gt; 组件间的水平间距</div><div class="line">	&quot;bgImgUrl&quot;: &quot;../img.png&quot; --&gt;卡片背景图</div><div class="line">	&quot;bgColor&quot;: &quot;#ffffff&quot;	--&gt;卡片背景色</div><div class="line">	&quot;cols&quot;:	[30,30] ??--&gt;每列的百分比，如果是N列，可以只写Array中只写N-1项，最后一项会自动填充，如果加一起大于100，就按照填写的来算</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><a href="http://tangram.pingguohe.net/docs/layout-support/inner-support" target="_blank" rel="external"></a></p>
<p><img src="https://ooo.0o0.ooo/2017/06/23/594ccd9375663.png" alt="流式布局style"><br><img src="https://ooo.0o0.ooo/2017/06/23/594ccdd3e0896.png" alt="流式布局style"><br><img src="https://ooo.0o0.ooo/2017/06/23/594ccdf8477f8.png" alt="流式布局style"></p>
<h1 id="使用步骤"><a href="#使用步骤" class="headerlink" title="使用步骤"></a>使用步骤</h1><ol>
<li>注册tangram组件:两种类型:文字与图片<blockquote>
<p>TangramSingleImageElement: 图片类型<br>TangramSimpleTextElement: 文字类型</p>
</blockquote>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[TangramDefaultItemModelFactory registElementType:@&quot;1&quot; className:@&quot;TangramSingleImageElement&quot;];</div><div class="line">	[TangramDefaultItemModelFactory registElementType:@&quot;2&quot; className:@&quot;TangramSimpleTextElement&quot;];</div></pre></td></tr></table></figure>
<ol>
<li>读取json数据,使用helper解析实例<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">	 //获取数据</div><div class="line"> 	NSString *mockDataPath = [NSString stringWithContentsOfFile:[[NSBundle mainBundle] pathForResource:@&quot;TangramMock&quot; ofType:@&quot;json&quot;] encoding:NSUTF8StringEncoding error:nil];</div><div class="line"> 	NSDictionary *dict = [mockDataPath objectFromJSONString];</div><div class="line">	 self.layoutModelArray = [[dict objectForKey:@&quot;data&quot;] objectForKey:@&quot;cards&quot;];</div><div class="line"> 	//使用helper解析成layout实例</div><div class="line">	 self.layoutArray = [TangramDefaultDataSourceHelper layoutsWithArray:self.layoutModelArray];	</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ol>
<p><a href="http://tangram.pingguohe.net/docs/layout-support/inner-support" target="_blank" rel="external">各种布局json type配置表</a>&gt;</p>
<ol>
<li>实现<code>TangramDataSource Delegate</code></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">//返回layout个数:卡片个数</div><div class="line">- (NSUInteger)numberOfLayoutsInTangramView:(TangramView *)view</div><div class="line">&#123;</div><div class="line">    return self.layoutModelArray.count;</div><div class="line">&#125;</div><div class="line">//返回layout的实例:实例内容有哪些</div><div class="line">- (UIView&lt;TangramLayoutProtocol&gt; *)layoutInTangramView:(TangramView *)view atIndex:(NSUInteger)index</div><div class="line">&#123;</div><div class="line">    return [self.layoutArray objectAtIndex:index];</div><div class="line">&#125;</div><div class="line">//返回某一个layout中itemModel的个数:一个卡片中组件的个数</div><div class="line">- (NSUInteger)numberOfItemsInTangramView:(TangramView *)view forLayout:(UIView&lt;TangramLayoutProtocol&gt; *)layout</div><div class="line">&#123;</div><div class="line">    return layout.itemModels.count;</div><div class="line">&#125;</div><div class="line">//返回layout中指定index的itemModel实例</div><div class="line">- (NSObject&lt;TangramItemModelProtocol&gt; *)itemModelInTangramView:(TangramView *)view forLayout:(UIView&lt;TangramLayoutProtocol&gt; *)layout atIndex:(NSUInteger)index</div><div class="line">&#123;</div><div class="line">    return [layout.itemModels objectAtIndex:index];;</div><div class="line">&#125;</div><div class="line">//根据Model生成View</div><div class="line">//以上的方法在调用Tangram的reload方法后就会执行，而这个方法是按需加载</div><div class="line">- (UIView *)itemInTangramView:(TangramView *)view withModel:(NSObject&lt;TangramItemModelProtocol&gt; *)model forLayout:(UIView&lt;TangramLayoutProtocol&gt; *)layout atIndex:(NSUInteger)index</div><div class="line">&#123;</div><div class="line">    //先尝试找可以复用的View，有的话就赋值，没有的话就生成一个</div><div class="line">    UIView *reuseableView = [view dequeueReusableItemWithIdentifier:model.reuseIdentifier];</div><div class="line">    </div><div class="line">    if (reuseableView) &#123;</div><div class="line">        reuseableView =  [TangramDefaultDataSourceHelper refreshElement:reuseableView byModel:model];</div><div class="line">    &#125;</div><div class="line">    else</div><div class="line">    &#123;</div><div class="line">        reuseableView =  [TangramDefaultDataSourceHelper elementByModel:model];</div><div class="line">    &#125;</div><div class="line">    return reuseableView;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ol>
<li>创建tangram实例</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">	-(TangramView *)tangramView</div><div class="line">&#123;</div><div class="line">    if (nil == _tangramView) &#123;</div><div class="line">        _tangramView = [[TangramView alloc]init];</div><div class="line">        _tangramView.frame = self.view.bounds;</div><div class="line">        //要设置datasouce delegate</div><div class="line">        [_tangramView setDataSource:self];</div><div class="line">        _tangramView.backgroundColor = [UIColor whiteColor];</div><div class="line">        [self.view addSubview:_tangramView];</div><div class="line">    &#125;</div><div class="line">    return _tangramView;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ol>
<li>刷新视图</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[self.tangramView reloadData];</div></pre></td></tr></table></figure>
<p><img src="https://ooo.0o0.ooo/2017/06/23/594cc6b32a9f6.png" alt="tangram执行流程"></p>
<h2 id="TangramDragableLayout"><a href="#TangramDragableLayout" class="headerlink" title="TangramDragableLayout"></a>TangramDragableLayout</h2><p>可拖动的item,<br><figure class="highlight plain"><figcaption><span>*fixLabyout = [[TangramDragableLayout alloc] init];</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">fixLabyout.alignType = TopRight;</div><div class="line">fixLabyout.offsetX = 0;</div><div class="line">fixLabyout.offsetY = 100;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">alignType: 设置位置类型</div><div class="line">typedef NS_ENUM(NSInteger, FixAlignType)</div><div class="line">&#123;</div><div class="line">    TopLeft = 0,		上左</div><div class="line">    TopRight,			上右</div><div class="line">    BottomLeft,			下左</div><div class="line">    BottomRight			下右</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>##TangramViewDatasource</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// 返回item的个数</div><div class="line">- (NSUInteger)numberOfLayoutsInTangramView:(TangramView *)view;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">// item复用(与cell类似)</div><div class="line">- (UIView *)itemInTangramView:(TangramView *)view withModel:(NSObject&lt;TangramItemModelProtocol&gt; *)model forLayout:(UIView&lt;TangramLayoutProtocol&gt; *)layout atIndex:(NSUInteger)index&#123;</div><div class="line">    DemoItem *item = (DemoItem *)[view dequeueReusableItemWithIdentifier:model.reuseIdentifier];</div><div class="line">    if (!item) &#123;</div><div class="line">#warning 1: frame invalid</div><div class="line">        item = [[DemoItem alloc] initWithFrame:CGRectMake(0, 0, 220, 20) reuseIdentifier:model.reuseIdentifier];</div><div class="line">    &#125;</div><div class="line">    </div><div class="line"></div><div class="line">    // 添加item的subview元素</div><div class="line">    UILabel *testLabel = [item viewWithTag:1001];</div><div class="line">    if (!testLabel) &#123;</div><div class="line">        testLabel = [[UILabel alloc] initWithFrame:CGRectMake(0, 0, 100, 30)];</div><div class="line">        testLabel.textColor = [UIColor redColor];</div><div class="line">        testLabel.backgroundColor = [UIColor whiteColor];</div><div class="line">        testLabel.tag = 1001;</div><div class="line">        [item addSubview:testLabel];</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    testLabel.text = [NSString stringWithFormat:@&quot;%ld&quot;,index];</div><div class="line"></div><div class="line">    return item;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// </div><div class="line">- (NSUInteger)numberOfItemsInTangramView:(TangramView *)view forLayout:(UIView&lt;TangramLayoutProtocol&gt; *)layout;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">// fixModel要实现TangramItemModelProtocol协议</div><div class="line">- (NSObject&lt;TangramItemModelProtocol&gt; *)itemModelInTangramView:(TangramView *)view forLayout:(UIView&lt;TangramLayoutProtocol&gt; *)layout atIndex:(NSUInteger)index&#123;</div><div class="line">    DemoFixModel *fixModel = [[DemoFixModel alloc] init];</div><div class="line">    return fixModel;</div><div class="line">&#125;</div></pre></td></tr></table></figure></section>
    
      <div class="tags">
        <span>Tags:</span>
        
  <span class="tag-code">ios</span>

  <span class="tag-code">tangram</span>

      </div>
    
    <div class="money-like">
      <div class="reward-btn">
        赏
        <span class="money-code">
          <span class="alipay-code">
            <div class="code-image"></div>
            <b>使用支付宝打赏</b>
          </span>
          <span class="wechat-code">
            <div class="code-image"></div>
            <b>使用微信打赏</b>
          </span>
        </span>
      </div>
      <p class="notice">若你觉得我的文章对你有帮助，欢迎点击上方按钮对我打赏</p>
    </div>
    <div class="qrcode">
      <canvas id="share-qrcode"></canvas>
      <p class="notice">扫描二维码，分享此文章</p>
    </div>
    <div id="comments"></div>
  </article>
</main>

<script>
  (function () {
    var url = 'https://neareven.github.io/2017/06/23/02-ios-tangram/';
    $('#article-banner').geopattern(url);
    $('.header').removeClass('fixed-header');

    var qr = new QRious({
      element: document.getElementById('share-qrcode'),
      value: url
    });
    
    var gitmentConfig = "undefined";
    if (gitmentConfig != "undefined") {
      var gitment = new Gitment({
        owner: "undefined",
        repo: "undefined",
        oauth: {
          client_id: "undefined",
          client_secret: "undefined"
        },
        theme: {
          render(state, instance) {
            const container = document.createElement('div')
            container.lang = "en-US"
            container.className = 'gitment-container gitment-root-container'
            container.appendChild(instance.renderHeader(state, instance))
            container.appendChild(instance.renderEditor(state, instance))
            container.appendChild(instance.renderComments(state, instance))
            container.appendChild(instance.renderFooter(state, instance))
            return container;
          }
        }
      })
      gitment.render(document.getElementById('comments'))
    }
  })();
</script>

    <div class="scroll-top">
  <span class="arrow-icon"></span>
</div>
    <footer class="app-footer">
  <p class="copyright">
    &copy; 2017 | Proudly powered by <a href="https://hexo.io" target="_blank">Hexo</a>
    <br>
    Theme by <a href="https://github.com/yanm1ng">yanm1ng</a>
  </p>
</footer>

<script>
  function async(u, c) {
    var d = document, t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
    s.parentNode.insertBefore(o, s);
  }
</script>
<script>
  async("//cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
    FastClick.attach(document.body);
  })
</script>
<script>
  var hasLine = 'true';
  async("//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js", function(){
    $('figure pre').each(function(i, block) {
      var figure = $(this).parents('figure');
      if (hasLine == 'false') {
        figure.find('.gutter').hide();
      }
      var lang = figure.attr('class').split(' ')[1] || '';
      var codeHtml = $(this).html();
      var codeTag = document.createElement('code');
      codeTag.className = lang;
      codeTag.innerHTML = codeHtml;
      $(this).attr('class', '').empty().html(codeTag);
      figure.attr('data-lang', lang.toUpperCase());
      hljs.highlightBlock(block);
    });
  })
</script>
<!-- Baidu Tongji -->

<script src="/js/script.js"></script>
  </body>
</html>